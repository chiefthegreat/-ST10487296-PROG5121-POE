name: Java Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: List repository contents
        run: find . -name "*.java" -type f | sort

      - name: Download dependencies
        run: |
          wget -O gson-2.10.1.jar https://repo1.maven.org/maven2/com/google/code/gson/gson/2.10.1/gson-2.10.1.jar
          wget -O junit-4.13.2.jar https://repo1.maven.org/maven2/junit/junit/4.13.2/junit-4.13.2.jar
          wget -O hamcrest-core-1.3.jar https://repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar

      - name: Compile main application
        run: |
          javac -cp ".:gson-2.10.1.jar" src/chatapp/*.java
          echo " Main application compiled"

      - name: Compile test classes
        run: |
          javac -cp ".:src:gson-2.10.1.jar:junit-4.13.2.jar" test/chatapp/*.java
          echo " Test classes compiled"

      - name: Run tests
        run: |
          echo "=== Running LoginTest ==="
          java -cp ".:src:test:gson-2.10.1.jar:junit-4.13.2.jar:hamcrest-core-1.3.jar" org.junit.runner.JUnitCore chatapp.LoginTest || echo "LoginTest completed with status: $?"

          echo "=== Running MessageIT ==="
          java -cp ".:src:test:gson-2.10.1.jar:junit-4.13.2.jar:hamcrest-core-1.3.jar" org.junit.runner.JUnitCore chatapp.MessageIT || echo "MessageIT completed with status: $?"

          echo "=== Running MessageManagerTest ==="
          java -cp ".:src:test:gson-2.10.1.jar:junit-4.13.2.jar:hamcrest-core-1.3.jar" org.junit.runner.JUnitCore chatapp.MessageManagerTest || echo "MessageManagerTest completed with status: $?"
