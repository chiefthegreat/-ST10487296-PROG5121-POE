name: Java Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Download dependencies
      run: |
        wget -O gson-2.10.1.jar https://repo1.maven.org/maven2/com/google/code/gson/gson/2.10.1/gson-2.10.1.jar
        wget -O junit-4.13.2.jar https://repo1.maven.org/maven2/junit/junit/4.13.2/junit-4.13.2.jar
        wget -O hamcrest-core-1.3.jar https://repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar
        
    - name: Compile main application
      run: |
        javac -cp ".:gson-2.10.1.jar" *.java
        echo " Main application compiled"
        
    - name: Remove package declarations from test files
      run: |
        # Remove package declarations since your main classes are in default package
        sed -i 's/package chatapp;//g' *Test.java *IT.java 2>/dev/null || true
        sed -i 's/import chatapp\.\*;//g' *Test.java *IT.java 2>/dev/null || true
        
    - name: Compile test classes
      run: |
        javac -cp ".:gson-2.10.1.jar:junit-4.13.2.jar" *Test.java *IT.java
        echo " Test classes compiled"
        
    - name: Run tests
      run: |
        echo "=== Running LoginTest ==="
        java -cp ".:gson-2.10.1.jar:junit-4.13.2.jar:hamcrest-core-1.3.jar" org.junit.runner.JUnitCore LoginTest
        
        echo "=== Running MessageIT ==="
        java -cp ".:gson-2.10.1.jar:junit-4.13.2.jar:hamcrest-core-1.3.jar" org.junit.runner.JUnitCore MessageIT
        
        echo "=== Running MessageManagerTest ==="
        java -cp ".:gson-2.10.1.jar:junit-4.13.2.jar:hamcrest-core-1.3.jar" org.junit.runner.JUnitCore MessageManagerTest
